"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[2553],{2224:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(70355);const s=(0,i(2156).A)((()=>n.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}))))},10169:(e,t,i)=>{i.d(t,{A:()=>A});var n=i(31635),s=i(44218),a=i(69440),o=i(70355),r=i(3375),l=i.n(r),d=i(63849),c=i(32312);const m=(0,o.memo)((({bodyClassName:e="accordion-item-body",children:t,className:i="accordion-item",classNameSelected:n="accordion-item--selected",headerClassName:s="accordion-item-header",headerClassNameSelected:a="accordion-item-header--selected",headerContent:r,itemId:m})=>{const{onToggle:p,selectedItemId:u}=(0,o.useContext)(c.A),g=u===m,h=(0,o.useCallback)(((e,t)=>{e.addEventListener("transitionend",(({target:i})=>{i===e&&t()}))}),[]);return o.createElement("li",{className:l()(i,{[n]:g})},o.createElement("div",{className:l()(s,{[a]:g})},r({isSelected:g,onToggle:p})),t?o.createElement(d.A,{addEndListener:h,classNames:e,in:g,mountOnEnter:!0,timeout:{},unmountOnExit:!0},o.createElement("div",{"aria-live":"polite",className:e},t)):null)}));var p=i(29853),u=i(82259),g=i(34953),h=i(28407);const S=e=>{var{id:t,isSelected:i,children:s}=e,a=(0,n.__rest)(e,["id","isSelected","children"]);return o.createElement(o.Fragment,null,o.createElement(g.A,Object.assign({},a,{checked:i,className:"form-checklist-checkbox optimizedCheckout-form-checklist-checkbox",id:t,type:"radio"})),o.createElement(h.A,{htmlFor:t},s))},A=(0,o.memo)((e=>{var{isDisabled:t,value:i,content:r,htmlId:l=(0,a.kebabCase)(i),label:d}=e,c=(0,n.__rest)(e,["isDisabled","value","content","htmlId","label"]);const{name:g=""}=(0,o.useContext)(u.C)||{},h=(0,o.useCallback)((0,s.B4)((e=>({field:n})=>o.createElement(S,Object.assign({},n,{disabled:t,id:l,isSelected:n.value===i,value:i}),d instanceof Function?d(e):d))),[l,t,d,i]),A=(0,o.useCallback)((0,s.B4)((e=>t=>{i===t&&e(i)})),[]),E=(0,o.useCallback)((({isSelected:e,onToggle:t})=>o.createElement(p.A,{className:"form-checklist-option",name:g,onChange:A(t),render:h(e)})),[A,g,h]);return o.createElement(m,Object.assign({},c,{bodyClassName:"form-checklist-body",className:"form-checklist-item optimizedCheckout-form-checklist-item",classNameSelected:"form-checklist-item--selected optimizedCheckout-form-checklist-item--selected",headerClassName:"form-checklist-header",headerClassNameSelected:"form-checklist-header--selected",headerContent:E,itemId:i}),r)}))},12402:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(98610);function s(e){if(e)return e===n.A.PaypalCommerce||e===n.A.PaypalCommerceCreditCards?n.A.PayPalCommerceAcceleratedCheckout:e===n.A.Braintree?n.A.BraintreeAcceleratedCheckout:e}},13400:(e,t,i)=>{i.d(t,{A:()=>d});var n=i(69440),s=i(70355),a=i(49655),o=i(63163),r=i(24391),l=i(76966);const d=({headerId:e,messageId:t,isModalOpen:i,action:d,actionButtonLabel:c,onRequestClose:m=n.noop,shouldShowCloseButton:p=!0})=>s.createElement(r.A,{additionalModalClassName:"modal--confirm",footer:s.createElement(o.Ay,{onClick:d,size:o.Mp.Small,variant:o.Ak.Primary},null!=c?c:s.createElement(a.A,{id:"common.confirm_action"})),header:s.createElement(l.A,null,s.createElement("span",{"aria-live":"assertive",role:"alert"},s.createElement(a.A,{id:e}))),isOpen:i,onRequestClose:m,shouldShowCloseButton:p},s.createElement("p",{"aria-live":"assertive",role:"alert"},s.createElement(a.A,{id:t})))},24391:(e,t,i)=>{i.d(t,{A:()=>p});var n=i(31635),s=i(3375),a=i.n(s),o=i(69440),r=i(70355),l=i(38003),d=i.n(l),c=i(72769);const m=(0,i(2156).A)((()=>r.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},r.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})))),p=e=>{var{children:t,closeButtonLabel:i="Close",footer:s,header:l,additionalHeaderClassName:p,additionalBodyClassName:u,additionalModalClassName:g,onRequestClose:h=o.noop,shouldShowCloseButton:S=!1}=e,A=(0,n.__rest)(e,["children","closeButtonLabel","footer","header","additionalHeaderClassName","additionalBodyClassName","additionalModalClassName","onRequestClose","shouldShowCloseButton"]);const E=(0,r.useCallback)((e=>{h(e)}),[h]);return r.createElement(d(),Object.assign({},A,{ariaHideApp:!0,bodyOpenClassName:"has-activeModal",className:{base:a()("modal optimizedCheckout-contentPrimary",g),afterOpen:"modal--afterOpen",beforeClose:"modal--beforeClose"},closeTimeoutMS:200,onRequestClose:h,overlayClassName:{base:"modalOverlay",afterOpen:"modalOverlay--afterOpen",beforeClose:"modalOverlay--beforeClose"},shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!1}),r.createElement("div",{className:a()("modal-header",p)},l,S&&r.createElement("a",{className:"modal-close","data-test":"modal-close-button",href:"#",onClick:(0,c.A)(E)},Boolean(i)&&r.createElement("span",{className:"is-srOnly"},i),r.createElement(m,null))),r.createElement("div",{className:a()("modal-body",u),"data-test":"modal-body"},t),Boolean(s)&&r.createElement("div",{className:"modal-footer","data-test":"modal-footer"},s))}},24750:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(31635),s=i(3375),a=i.n(s),o=i(70355);const r=(0,o.forwardRef)(((e,t)=>{var{additionalClassName:i,children:s,className:r,legend:l,testId:d}=e,c=(0,n.__rest)(e,["additionalClassName","children","className","legend","testId"]);return o.createElement("fieldset",Object.assign({},c,{className:r||a()("form-fieldset",i),"data-test":d,ref:t}),l,o.createElement("div",{className:"form-body"},s))}))},32312:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(69440);const s=(0,i(70355).createContext)({onToggle:n.noop})},34257:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Jt});var n=i(31635),s=i(69440),a=i(70355),o=i(49655),r=i(17986),l=i(13400),d=i(39886),c=i(95108),m=i(84494),p=i(59456),u=i(77050),g=i(28058),h=i(79001),S=i(12402),A=i(74027),E=i(21106),v=i(98610);function C(e,t){var i;const n=[v.A.AmazonPay,v.A.BraintreeAcceleratedCheckout,v.A.PayPalCommerceAcceleratedCheckout],s=(0,S.A)(null===(i=t.checkoutSettings)||void 0===i?void 0:i.providerWithCustomCheckout),a=(0,E.A)(e);return a&&n.includes(a.providerId)?a.providerId:s&&n.includes(s)?s:void 0}function y(e){var t;const{digitalItems:i=[],physicalItems:n}=e.lineItems;return(null===(t=[...i,...n].filter((e=>e.addedByPromotion)))||void 0===t?void 0:t.length)>0}const f=(0,m.Mz)((({checkoutService:{deleteConsignment:e}})=>e),(({checkoutState:{data:e}})=>e.getConsignments()),((e,t)=>()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(!t||!t.length)return;const[{data:i}]=yield Promise.all(t.map((({id:t})=>e(t))));return i.getShippingAddress()})))),b=()=>{const{checkoutState:e,checkoutService:t}=(0,p.Q)(),{data:{getCart:i,getCheckout:n,getConfig:s,getCustomer:a,getConsignments:o,getShippingAddress:r,getBillingAddress:l,getShippingAddressFields:d,getShippingCountries:c},statuses:{isShippingStepPending:m,isSelectingShippingOption:E,isLoadingShippingOptions:v,isUpdatingConsignment:b,isCreatingConsignments:_,isCreatingCustomerAddress:I,isLoadingShippingCountries:N,isUpdatingBillingAddress:O,isUpdatingCheckout:k,isDeletingConsignment:w,isLoadingCheckout:M}}=e,L=n(),F=s(),B=o()||[],P=a(),R=i();if(!(L&&F&&P&&R))throw new Error("Unable to access checkout data");const{checkoutSettings:{enableOrderComments:z,hasMultiShippingEnabled:T}}=F,U=C(L,F),V=v()||E()||b()||_()||O()||k()||I()||w()||M(),x=(0,A.A)(R),j=T&&!U&&x>1,D=!j&&B.length>1?void 0:r(),H=(0,S.A)(F.checkoutSettings.providerWithCustomCheckout);return{assignItem:t.assignItemsToAddress,billingAddress:l(),cart:R,cartHasPromotionalItems:y(R),consignments:B,countries:c()||h.M,customer:P,customerMessage:L.customerMessage,createCustomerAddress:t.createCustomerAddress,deinitializeShippingMethod:t.deinitializeShipping,deleteConsignments:f({checkoutService:t,checkoutState:e}),getFields:d,initializeShippingMethod:t.initializeShipping,isGuest:P.isGuest,isInitializing:N()||v(),isLoading:V,isShippingStepPending:m(),loadShippingAddressFields:t.loadShippingAddressFields,loadBillingAddressFields:t.loadBillingAddressFields,loadShippingOptions:t.loadShippingOptions,methodId:U,providerWithCustomCheckout:H,shippingAddress:D,shouldShowMultiShipping:j,shouldShowOrderComments:z,signOut:t.signOutCustomer,unassignItem:t.unassignItemsToAddress,updateBillingAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout,updateShippingAddress:t.updateShippingAddress,shouldRenderStripeForm:H===g.A.StripeUPE&&(0,u.A)(R)}};var _=i(52647),I=i(96097),N=i(3375),O=i.n(N),k=i(55150),w=i(68512),M=i(60288),L=i(69462);function F(e){return t=>{const i=e=>{const{resetForm:i,isInitialValueLoaded:n,initialValues:s}=e,o=(0,a.useRef)(n);return(0,a.useEffect)((()=>{!1===o.current&&!0===n&&i({values:null!=s?s:{}}),o.current=n}),[n,s,i]),a.createElement(t,Object.assign({},e))};return i.displayName=`WithFormikExtended(${t.displayName||t.name})`,(0,L.bk)(e)(i)}}var B=i(46487),P=i(72769),R=i(53133),z=i(45080),T=i(33318),U=i(94202),V=i(68801),x=i(4899),j=i(92909),D=i(58330),H=i(38546),q=i(62562),$=i(33515),G=i(22011);const K=(0,w.A)((0,L.bk)({handleSubmit:(e,{props:{onSaveAddress:t}})=>{t(e)},mapPropsToValues:({getFields:e,selectedAddress:t})=>(0,G.A)(e(t&&t.countryCode),t),validationSchema:({language:e,getFields:t})=>(0,U.RZ)((i=>(0,$.A)({language:e,formFields:t(i&&i.countryCode)})))})((({getFields:e,values:t,setFieldValue:i,isLoading:n,onRequestClose:s})=>a.createElement(x.A,{autoComplete:"on"},a.createElement(V.A,{isLoading:n},a.createElement(H.A,{countryCode:t.countryCode,formFields:e(t.countryCode),setFieldValue:i,shouldShowSaveAddress:!1,type:q.A.Shipping}),a.createElement("div",{className:"form-actions"},a.createElement(B.Ay,{onClick:s,variant:B.Ak.Secondary},a.createElement(o.A,{id:"common.cancel_action"})),a.createElement(B.Ay,{disabled:n,id:"checkout-save-address",type:"submit",variant:B.Ak.Primary},a.createElement(o.A,{id:"address.save_address_action"})))))))),J=e=>{var{isOpen:t,onAfterOpen:i,onRequestClose:s}=e,r=(0,n.__rest)(e,["isOpen","onAfterOpen","onRequestClose"]);return a.createElement(j.A,{additionalModalClassName:"modal--medium",header:a.createElement(D.A,null,a.createElement(o.A,{id:"address.add_address_heading"})),isOpen:t,onAfterOpen:i,onRequestClose:s,shouldShowCloseButton:!0},a.createElement(K,Object.assign({},r,{onRequestClose:s})))};var W=i(49102),Q=i(31689),Y=i(84087),Z=i(4853),X=i(85021);class ee extends Z.A{constructor(e){super({name:"ASSIGN_ITEM_INVALID_ADDRESS",message:(0,Y.A)().translate("shipping.assign_item_invalid_address_error"),title:(0,Y.A)().translate("shipping.assign_item_invalid_address_error_heading"),data:e}),(0,X.h)(this,ee.prototype)}}class te extends Z.A{constructor(e){super({name:"ASSIGN_ITEM_FAILED",message:(0,Y.A)().translate("shipping.assign_item_error"),data:e}),(0,X.h)(this,te.prototype)}}const ie=(0,i(2156).A)((()=>a.createElement("svg",{fill:"none",height:"20",viewBox:"0 0 20 20",width:"20",xmlns:"http://www.w3.org/2000/svg"},a.createElement("path",{d:"M2.49902 14.5511V17.0844C2.49902 17.3178 2.68236 17.5011 2.91569 17.5011H5.44902C5.55736 17.5011 5.66569 17.4594 5.74069 17.3761L14.8407 8.28444L11.7157 5.15944L2.62402 14.2511C2.54069 14.3344 2.49902 14.4344 2.49902 14.5511ZM17.2574 5.86777C17.5824 5.54277 17.5824 5.01777 17.2574 4.69277L15.3074 2.74277C14.9824 2.41777 14.4574 2.41777 14.1324 2.74277L12.6074 4.26777L15.7324 7.39277L17.2574 5.86777Z"}))));var ne=i(63650);const se=({onUseNewAddress:e,selectedAddress:t})=>{const{themeV2:i}=(0,k.w)();return a.createElement("div",{className:"guest-consignment-line-item-header"},t?a.createElement(a.Fragment,null,a.createElement(ne.A,{address:t}),a.createElement("a",{className:i?"body-cta":"","data-test":"edit-shipping-address",href:"#",onClick:(0,P.A)(e)},a.createElement(ie,null))):a.createElement(a.Fragment,null,a.createElement("h3",{className:i?"body-bold":""},a.createElement(o.A,{id:"shipping.guest_multishipping_no_shipping_address_message"})),a.createElement("a",{className:i?"body-cta":"","data-test":"enter-shipping-address",href:"#",onClick:(0,P.A)(e)},a.createElement(o.A,{id:"shipping.guest_multishipping_enter_shipping_address_action"}))))},ae=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;const s=new Map(e.map((e=>{var t;return[e.id,null===(t=e.selectedShippingOption)||void 0===t?void 0:t.id]})));for(const e of t)if(!e.selectedShippingOption){const t=s.get(e.id);if(t){yield i(e.id,t);continue}const a=null===(n=e.availableShippingOptions)||void 0===n?void 0:n.find((e=>e.isRecommended));a&&(yield i(e.id,a.id))}})),oe=({consignment:e,defaultCountryCode:t,isLoading:i,onUnhandledError:s,selectedAddress:r,setConsignmentRequest:l})=>{const[c,m]=(0,a.useState)(!1),[u,g]=(0,a.useState)(),{checkoutState:{data:{getCustomer:S,getConfig:A,getConsignments:E,getShippingAddressFields:v}},checkoutService:{updateConsignment:C,createCustomerAddress:y,selectConsignmentShippingOption:f}}=(0,p.Q)(),b=S();if(!A()||!b)return null;const _=b.addresses||h.M,I=b.isGuest,N=t=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var i;if(!(0,T.A)(t,v(t.countryCode)))return s(new ee);if(e)try{const{data:{getConsignments:n}}=yield C({id:e.id,address:t,shippingAddress:t,lineItems:e.lineItems.map((({id:e,quantity:t})=>({itemId:e,quantity:t})))}),s=n();s&&s.length>0&&(yield ae(null!==(i=E())&&void 0!==i?i:[],s,f))}catch(e){e instanceof Error&&s(new te(e))}else null==l||l({address:t,shippingAddress:t,lineItems:[]})})),O=()=>{m(!0)};return a.createElement(a.Fragment,null,a.createElement(Q.A,{error:u,message:a.createElement(a.Fragment,null,a.createElement(o.A,{id:"address.consignment_address_updated_text"})," ",a.createElement(o.A,{id:"customer.create_address_error"})),onClose:()=>{g(void 0)},shouldShowErrorCode:!1}),a.createElement(J,{defaultCountryCode:t,getFields:v,isLoading:i,isOpen:c,onRequestClose:()=>{m(!1)},onSaveAddress:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const t=(0,d.A)(e);if(yield N(t),!I)try{yield y(t)}catch(e){e instanceof Error&&g(e)}m(!1)})),selectedAddress:I?r:void 0}),I?a.createElement(se,{onUseNewAddress:O,selectedAddress:r}):a.createElement(W.A,{addresses:_,onSelectAddress:N,onUseNewAddress:O,placeholderText:a.createElement(o.A,{id:"shipping.choose_shipping_address"}),selectedAddress:r,showSingleLineAddress:!0,type:q.A.Shipping}))};var re=i(83651),le=i(38116),de=i(11100),ce=i(63163),me=i(81339),pe=i(97429),ue=i(2224),ge=i(52523);const he=()=>a.createElement(pe.A,{placement:"right-start",tooltip:a.createElement(ge.A,null,a.createElement(o.A,{id:"shipping.multishipping_item_split_tooltip_message"}))},a.createElement("span",{className:"item-split-tooltip","data-test":"split-item-tooltip"},a.createElement(ue.A,null))),Se=({assignedItems:e,onUnassignItem:t})=>{const{themeV2:i}=(0,k.w)();return a.createElement("div",{className:"allocated-line-items"},a.createElement("h3",{className:i?"body-bold":""},a.createElement(o.A,{data:{count:e.shippableItemsCount},id:"shipping.multishipping_item_allocated_message"}),e.hasSplitItems&&a.createElement(he,null)),a.createElement("ul",{className:"allocated-line-items-list"},e.lineItems.map((e=>a.createElement("li",{key:e.id},(0,me.h)(e,i),a.createElement("span",{"data-test":`remove-${e.id.toString()}-button`,onClick:()=>t(e)},a.createElement(R.A,null)))))))};var Ae=i(22375),Ee=i(54454);const ve=({item:e,error:t})=>{var i;const n=(0,de.A)(),{themeV2:s}=(0,k.w)();return a.createElement("tr",null,a.createElement("td",{className:"left-to-allocate-item-name-container"},a.createElement("figure",{className:"left-to-allocate-item-figure"},e.imageUrl&&a.createElement("img",{alt:e.name,src:e.imageUrl})),a.createElement("div",null,a.createElement("p",{className:O()("left-to-allocate-item-name",{"body-regular":s})},e.name),null===(i=e.options)||void 0===i?void 0:i.map((e=>a.createElement("p",{className:O()("left-to-allocate-item-option",{"sub-text-medium":s}),key:e.nameId},e.name,": ",e.value))))),!n&&a.createElement("td",{className:s?"body-regular":""},e.quantity),a.createElement("td",{className:s?"body-regular":""},n&&a.createElement(o.A,{data:{count:e.quantity},id:"shipping.multishipping_left_to_allocate_message"}),a.createElement(Ae.A,{additionalClassName:t?"form-field--error":"",input:({field:t})=>a.createElement(Ee.A,Object.assign({},t,{"aria-label":`Quantity of ${e.name}`,disabled:0===e.quantity,id:t.name,min:0,themeV2:s,type:"number"})),name:e.id.toString()})))},Ce=({items:e,formErrors:t})=>{const i=(0,de.A)(),{themeV2:n}=(0,k.w)();return a.createElement("table",{className:"table left-to-allocate-items-table"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",{className:n?"body-medium":""},a.createElement(o.A,{id:"shipping.multishipping_left_to_allocate_items_table_item"})),!i&&a.createElement("th",{className:n?"body-medium":""},a.createElement(o.A,{id:"shipping.multishipping_left_to_allocate_items_table_left_to_allocate"})),a.createElement("th",{className:n?"body-medium":""},a.createElement(o.A,{id:"shipping.multishipping_left_to_allocate_items_table_quantity"})))),a.createElement("tbody",null,e.map((e=>a.createElement(ve,{error:t[e.id.toString()],item:e,key:e.id})))))};var ye;!function(e){e[e.Physical=0]="Physical",e[e.Digital=1]="Digital",e[e.GiftCertificate=2]="GiftCertificate",e[e.Custom=3]="Custom"}(ye||(ye={}));const fe=(0,w.A)(F({handleSubmit:(e,{props:{onAllocateItems:t}})=>{t(Object.keys(e).filter((t=>e[t]>0)).map((t=>({itemId:t,quantity:e[t]}))))},mapPropsToValues:({unassignedItems:e})=>{const t={};return e.lineItems.forEach((e=>{t[e.id.toString()]=0})),t},enableReinitialize:!0,validationSchema:({language:e,unassignedItems:t})=>{const i=t=>{const i=(0,U.ai)().required(e.translate("shipping.quantity_required_error")).integer(e.translate("shipping.quantity_invalid_error")).min(0,e.translate("shipping.quantity_min_error")).max(t.quantity,e.translate("shipping.quantity_max_error"));return t.type===ye.Custom?i.oneOf([0,t.quantity],e.translate("shipping.custom_item_quantity_error")):i},n=Object.fromEntries(t.lineItems.map((e=>[e.id.toString(),i(e)])));return(0,U.Ik)().shape(n)},validateOnBlur:!0,validateOnChange:!1})((({consignmentNumber:e,isOpen:t,onRequestClose:i,address:n,assignedItems:s,unassignedItems:r,setValues:l,values:d,dirty:c,submitForm:m,errors:p,onUnassignItem:u,isLoading:g})=>{const{themeV2:h}=(0,k.w)(),S=(0,a.useMemo)((()=>{const e=r.shippableItemsCount;if(d&&c){const t=Object.keys(d).reduce(((e,t)=>(d[t]>0&&(e+=d[t]),e)),0);return a.createElement(o.A,{data:{count:`${t}/${e}`},id:"shipping.multishipping_items_selected_message"})}return a.createElement(o.A,{data:{count:e},id:"shipping.multishipping_item_to_allocate_message"})}),[d]),A=(0,a.useMemo)((()=>Object.keys(p).reduce(((e,t)=>{const i=p[t];return i&&e.push(i),Array.from(new Set(e))}),[])),[p]),E=!!s&&s.lineItems.length>0&&!!u,v=!!r&&r.lineItems.length>0,C=a.createElement(a.Fragment,null,a.createElement(B.Ay,{className:h?"body-medium":"",disabled:g,onClick:i,variant:ce.Ak.Secondary},a.createElement(o.A,{id:"shipping.multishipping_items_allocate_cancel"})),a.createElement(B.Ay,{className:h?"body-medium":"",disabled:!E&&!c,isLoading:g,onClick:m,type:"submit",variant:ce.Ak.Primary},E?a.createElement(o.A,{id:"shipping.multishipping_items_allocate_save"}):a.createElement(o.A,{id:"shipping.multishipping_items_allocate_allocate"})));return a.createElement(j.A,{additionalModalClassName:"allocate-items-modal",footer:C,header:a.createElement(a.Fragment,null,a.createElement(D.A,{additionalClassName:h?"header":""},a.createElement(o.A,{data:{consignmentNumber:e},id:"shipping.multishipping_consignment_index_heading"})),a.createElement("h4",{className:h?"body-medium":""},(0,ne.k)(n))),isOpen:t,onRequestClose:i},a.createElement(x.A,null,A.length>0&&a.createElement("div",{className:"form-errors"},A.map(((e,t)=>a.createElement(M.A,{key:t,type:M.v.Error},e)))),r.hasDigitalItems&&a.createElement(M.A,{type:M.v.Info},a.createElement(o.A,{id:"shipping.multishipping_digital_item_no_shipping_banner"})),E&&a.createElement(Se,{assignedItems:s,onUnassignItem:u}),v?a.createElement(a.Fragment,null,a.createElement("div",{className:"left-to-allocate-items-table-actions"},a.createElement("p",{className:h?"body-regular":""},S,r.hasSplitItems&&a.createElement(he,null)),a.createElement("div",{className:"button-group"},a.createElement("a",{className:h?"body-cta":"","data-test":"clear-all-items-button",href:"#",onClick:(0,P.A)((()=>{const e={};r.lineItems.forEach((t=>{e[t.id.toString()]=0})),l(e)}))},a.createElement(o.A,{id:"shipping.multishipping_items_allocate_clear_all"})),a.createElement("a",{className:h?"body-cta":"","data-test":"allocate-all-items-button",href:"#",onClick:(0,P.A)((()=>{const e={};r.lineItems.forEach((t=>{e[t.id.toString()]=t.quantity})),l(e)}))},a.createElement(o.A,{id:"shipping.multishipping_items_allocate_select_all_items_left"})))),a.createElement(Ce,{formErrors:p,items:r.lineItems})):null))})));class be extends Z.A{constructor(e){super({name:"UNASSIGN_ITEM_FAILED",message:(0,Y.A)().translate("shipping.unassign_item_error"),data:e}),(0,X.h)(this,be.prototype)}}const _e=e=>btoa(encodeURIComponent(e.join("-")));const Ie=e=>e.reduce(((e,t)=>e+t.quantity),0),Ne=(e,t)=>{const i=new Set;for(const n of e){const e=t.get(n.id.toString());if(e){if(i.has(e))return!0;i.add(e)}}return!1};function Oe(e,t){var i;const n=new Map,s=new Map,a=new Map,o=[];e.physicalItems.forEach((e=>{n.set(e.id.toString(),Object.assign(Object.assign({},e),{type:ye.Physical})),a.set(e.id.toString(),(e=>{return _e([e.productId.toString(),e.variantId.toString(),e.sku,(t=e.options,t?_e(t.map((e=>_e([e.name,e.nameId.toString(),e.value,e.valueId?e.valueId.toString():""])))):"")]);var t})(e))})),null===(i=e.customItems)||void 0===i||i.forEach((e=>n.set(e.id,Object.assign(Object.assign({},e),{type:ye.Custom})))),e.digitalItems.forEach((e=>s.set(e.id.toString(),Object.assign(Object.assign({},e),{type:ye.Digital})))),t.forEach(((e,t)=>{const i=[];e.lineItemIds.forEach((e=>{const t=n.get(e);t&&(i.push(t),n.delete(e))})),o.push(Object.assign(Object.assign({},e),{consignmentNumber:t+1,hasDigitalItems:!1,hasSplitItems:Ne(i,a),shippableItemsCount:Ie(i),lineItems:i}))}));const r=Array.from(n.values()),l={lineItems:r,hasDigitalItems:s.size>0,hasSplitItems:Ne(r,a),shippableItemsCount:Ie(r)};return{consignmentList:o,unassignedItems:l}}const ke={unassignedItems:{lineItems:[],hasDigitalItems:!1,hasSplitItems:!1,shippableItemsCount:0},consignmentList:[]},we=()=>{const{checkoutState:{data:{getCheckout:e}}}=(0,p.Q)(),t=e();if(!t)return ke;const{cart:{lineItems:i},consignments:n}=t,s=function(e){return Object.assign(Object.assign({},e),{physicalItems:e.physicalItems.filter((e=>"string"!=typeof e.parentId)),digitalItems:e.digitalItems.filter((e=>"string"!=typeof e.parentId))})}(i),{consignmentList:a,unassignedItems:o}=Oe(s,n);return{unassignedItems:o,consignmentList:a}},Me=({consignmentNumber:e,consignment:t,onUnhandledError:i,isLoading:s})=>{const[r,l]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!0),{unassignedItems:m}=we(),{checkoutService:{assignItemsToAddress:u}}=(0,p.Q)(),g=(()=>{const{checkoutService:{createConsignments:e,deleteConsignment:t}}=(0,p.Q)();return(i,s,a)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;let o=a.id;if(a.lineItemIds.length>1){const t=(yield e([i])).data.getConsignments();o=null===(n=null==t?void 0:t.find((e=>e.lineItemIds.find((e=>e===s)))))||void 0===n?void 0:n.id}if(!o)throw new Error("Unable to find consignment to delete");t(o)}))})(),{themeV2:h}=(0,k.w)(),S=()=>{l(!r)},A=(0,de.A)(),E=t.shippableItemsCount;return a.createElement("div",null,a.createElement(fe,{address:t.shippingAddress,assignedItems:t,consignmentNumber:e,isLoading:s,isOpen:r,onAllocateItems:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield u({address:t.address,lineItems:e})}catch(e){e instanceof Error&&i(new te(e))}finally{S()}})),onRequestClose:S,onUnassignItem:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{const i={address:t.address,shippingAddress:t.shippingAddress,lineItems:[{quantity:e.quantity,itemId:e.id}]};yield g(i,e.id.toString(),t)}catch(e){e instanceof Error&&i(new be(e))}})),unassignedItems:m}),a.createElement("div",{className:"consignment-line-item-header"},a.createElement("div",null,a.createElement("h3",{className:h?"body-bold":""},a.createElement(o.A,{data:{count:E},id:"shipping.multishipping_item_allocated_message"})),t.hasSplitItems&&a.createElement(he,null),a.createElement("a",{className:O()("expand-items-button",{"body-cta":h}),"data-test":"expand-items-button",href:"#",onClick:(0,P.A)((()=>{c(!d)}))},d?a.createElement(a.Fragment,null,!A&&a.createElement(o.A,{id:"shipping.multishipping_item_hide_items_message"}),a.createElement(re.A,null)):a.createElement(a.Fragment,null,!A&&a.createElement(o.A,{id:"shipping.multishipping_item_show_items_message"}),a.createElement(le.A,null)))),a.createElement("a",{className:h?"body-cta":"","data-test":"reallocate-items-button",href:"#",onClick:(0,P.A)(S)},a.createElement(o.A,{id:"shipping.multishipping_item_reallocated_message"}))),d?a.createElement(me.A,{lineItems:t.lineItems}):null)};var Le=i(25656),Fe=i(16919);const Be=({consignmentId:e,selectedShippingOptionId:t,shippingOption:i,handleSelect:n})=>{const{themeV2:s}=(0,k.w)(),o=a.createElement("span",{className:s?"body-regular":""},`${i.description} - `,a.createElement(Fe.A,{amount:i.cost}));return a.createElement("ul",{className:"shipping-option-item"},a.createElement(Le.A,{checked:t===i.id,id:`shippingOption-${e}-${i.id}`,key:`key-${e}-${i.id}`,label:o,name:`${e}-shippingMethod`,onClick:()=>{n(e,i.id)},readOnly:!0,value:i.id}))},Pe=(0,a.memo)((({consignmentId:e,isLoading:t,shippingOptions:i,selectedShippingOptionId:n,onSelectedOption:s})=>a.createElement(V.A,{isLoading:t},i.map((t=>a.createElement(Be,{consignmentId:e,handleSelect:s,key:t.id,selectedShippingOptionId:n,shippingOption:t}))))));var Re=i(45293);function ze(e,t){return(0,s.reduce)(e&&e.lineItems.physicalItems||[],((e,i,n)=>!i.addedByPromotion&&(0,s.isNil)(i.parentId)?e.concat(...function(e,t,i){let n=[];const a=function(e,t){return(0,s.find)(e,(e=>(0,s.includes)(e.lineItemIds,t)))}(t,e.id);for(let t=0;t<e.quantity;t++)n=n.concat(Object.assign(Object.assign({},e),{key:`${e.variantId}-${e.productId}-${i}-${t}`,consignment:a,quantity:1}));return n}(i,t,n)):e),[])}var Te=i(45980);function Ue(e){if(e)return e.find((({isRecommended:e})=>e))}const Ve=({consignments:e})=>{const t={};return(e||[]).forEach((e=>{t[e.id]=e.selectedShippingOption?e.selectedShippingOption.id:""})),{shippingOptionIds:t}};var xe=i(75794),je=i(53056);const De=({cart:e,consignment:t})=>a.createElement("div",{className:"staticConsignment"},a.createElement("strong",null,a.createElement(o.A,{id:"shipping.shipping_address_heading"})),a.createElement(xe.A,{address:t.shippingAddress,type:q.A.Shipping}),a.createElement(je.A,{cart:e,consignment:t}));var He=i(17080);const qe=({message:e,isLoading:t})=>a.createElement(He.A,{additionalClassName:"shippingOptions-skeleton",isLoading:t,rows:2},a.createElement("div",{className:"shippingOptions-panel optimizedCheckout-overlay"},a.createElement("p",{"aria-live":"polite",className:"shippingOptions-panel-message optimizedCheckout-primaryContent",role:"alert"},e)));var $e=i(91182),Ge=i(10169),Ke=i(82259);function Je(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const t="https://api.bundleb2b.net/api",i="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdG9yZV9oYXNoIjoidDk5enB0ODVlbyIsImRiIjoiZGVmYXVsdCIsImVtYWlsIjoicm9kcmlnb0BzcGFjZS5iYXIiLCJuYW1lIjoiYnVuZGxlIiwiZXZlbnRfY2hhbm5lbCI6ImFwaSIsInRva2VuX3ZlcnNpb24iOiJ2MyJ9.Jks1ab56gESbB7y0bpZt_zrWIH1r3R1R9djdsVRVrfU";if(void 0!==e)try{const s=yield fetch(`${t}/v3/io/companies?customerId=${e}`,{headers:{"Content-Type":"application/json",authToken:i}}).then((e=>e.json())).then((e=>e.data.map((e=>e.companyId)))),a=yield Promise.all(s.map((e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const s=(yield fetch(`${t}/v3/io/companies/${e}`,{headers:{"Content-Type":"application/json",authToken:i}}).then((e=>e.json())).then((e=>e.data))).extraFields.find((e=>"Transporte:"===e.fieldName)).fieldValue.split(","),a=yield function(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const t="https://beta.selanusa.com.mx",i=e.map((e=>parseInt(e,10))),n=JSON.stringify(i);return(yield fetch(`${t}/carriers?ids=${n}`).then((e=>e.json()))).map((e=>e.name))}catch(e){return console.error(e),[]}}))}(s);return a})))));return a.flat()}catch(e){return console.error("Error getting carriers",e),[]}}))}var We=i(13061);const Qe=({consignmentId:e,isMultiShippingMode:t,selectedShippingOptionId:i,shippingOption:n})=>{const s=i===n.id,o=(0,a.useCallback)((()=>a.createElement("div",{className:"shippingOptionLabel"},a.createElement(We.A,{displayAdditionalInformation:!0,method:n}),s&&!t&&a.createElement($e.Y,{region:"shipping.selectedShippingMethod"}))),[s,t,n]);return a.createElement(Ge.A,{htmlId:`shippingOptionRadio-${e}-${n.id}`,label:o,value:n.id})},Ye=(0,a.memo)((({consignmentId:e,customerId:t,customerGroupId:i,postalCode:s,stateOrProvince:o,inputName:r,isLoading:l,isMultiShippingMode:d,shippingOptions:c=h.M,selectedShippingOptionId:m,onSelectedOption:p})=>{const[u,g]=(0,a.useState)([]),S=(0,a.useCallback)((t=>{p(e,t)}),[e,p]),A=()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(!c.length)return;const e=(yield Je(t))||[],i=E(e),s=yield function(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const e="https://beta.selanusa.com.mx";return(yield fetch(`${e}/default-carriers`).then((e=>e.json()))).map((e=>e.name))}catch(e){return console.error(e),[]}}))}(),a=E(s).concat(i);g(a)}));(0,a.useEffect)((()=>{A()}),[s,o]);const E=e=>{const t=[];for(const n of e){const e=c.find((e=>e.description===n));if(!e)continue;const a=570===i&&"Ciudad de MÃ©xico"===o;("Boutique Selanusa"!==e.description&&"Recoger CLS"!==e.description||("06080"===s&&"Boutique Selanusa"===e.description||"07040"===s&&"Recoger CLS"===e.description)&&a)&&t.push(e)}return t};return c.length?a.createElement(V.A,{isLoading:l},u?a.createElement(Ke.A,{"aria-live":"polite",defaultSelectedItemId:m,name:r,onSelect:S},u.map((t=>a.createElement(Qe,{consignmentId:e,isMultiShippingMode:d,key:t.id,selectedShippingOptionId:m,shippingOption:t})))):a.createElement("h4",null,"No hay transportistas disponibles")):null})),Ze=F({handleSubmit:s.noop,mapPropsToValues:Ve})((e=>{const{consignments:t,customerId:i,customerGroupId:s,cart:r,isMultiShippingMode:l,selectShippingOption:d,isLoading:c,shouldShowShippingOptions:m,invalidShippingMessage:p,methodId:u,subscribeToConsignments:g,setFieldValue:h,shippingFormRenderTimestamp:S,setValues:A}=e,{analyticsTracker:E}=(0,Te.A)(),v=e=>(0,n.__awaiter)(void 0,[e],void 0,(function*({data:e}){const t=(e.getConsignments()||[]).find((({selectedShippingOption:e,availableShippingOptions:t})=>!e&&t));if(!t||!t.availableShippingOptions)return;const{availableShippingOptions:i,id:n}=t,s=Ue(i),a=1===i.length&&i[0],o=s||a;o&&(yield d(n,o.id),h(`shippingOptionIds.${n}`,o.id))}));return(0,a.useEffect)((()=>{const e=g(v);return()=>{e&&e()}}),[]),(0,a.useEffect)((()=>{(null==t?void 0:t.length)&&m&&E.showShippingMethods()}),[t,m]),(0,a.useEffect)((()=>{S&&A(Ve(e))}),[S]),(null==t?void 0:t.length)&&m?a.createElement(a.Fragment,null,t.map((e=>a.createElement("div",{className:"shippingOptions-container form-fieldset",key:e.id},l&&a.createElement(De,{cart:r,consignment:e}),a.createElement(Ye,{consignmentId:e.id,customerGroupId:s,customerId:i,inputName:`shippingOptionIds.${e.id}`,isLoading:c(e.id),isMultiShippingMode:l,onSelectedOption:d,postalCode:e.shippingAddress.postalCode,selectedShippingOptionId:e.selectedShippingOption&&e.selectedShippingOption.id,shippingOptions:e.availableShippingOptions,stateOrProvince:e.shippingAddress.stateOrProvince}),(!e.availableShippingOptions||!e.availableShippingOptions.length)&&a.createElement(qe,{isLoading:c(e.id),message:p}))))):a.createElement(qe,{isLoading:c(),message:a.createElement(o.A,{id:u||l?"shipping.select_shipping_address_text":"shipping.enter_shipping_address_text"})})})),Xe=(0,m.Mz)((({checkoutService:e})=>e.subscribe),(e=>t=>e(t,(({data:e})=>e.getConsignments())))),et=(0,m.Mz)(((e,t)=>t),(({statuses:e})=>e.isLoadingShippingOptions),(({statuses:e})=>e.isSelectingShippingOption),(({statuses:e})=>e.isUpdatingConsignment),(({statuses:e})=>e.isCreatingConsignments),((e,t,i,n,s)=>a=>e||t()||i(a)||n(a)||s()));const tt=(0,Re.A)((function({checkoutService:e,checkoutState:t},i){var n;const{data:{getCart:a,getConsignments:o,getConfig:r,getCustomer:l,getCheckout:d},statuses:{isSelectingShippingOption:c}}=t,m=l(),p=a(),u=r(),g=d(),h=null==m?void 0:m.id,S=null===(n=null==m?void 0:m.customerGroup)||void 0===n?void 0:n.id;if(!(u&&g&&m&&p))return null;const A=((e,t)=>{if(t.length<2)return t;const i=ze(e,t),n=(0,s.uniq)((0,s.map)(i,"consignment.id"));return(0,s.sortBy)(t,(e=>n.indexOf(e.id)))})(p,o()||[]),E=C(g,u),{shippingQuoteFailedMessage:v}=u.checkoutSettings;return{cart:p,customerId:h,customerGroupId:S,consignments:A,invalidShippingMessage:v,isLoading:et(t,i.isUpdatingAddress),isSelectingShippingOption:c,methodId:E,selectShippingOption:e.selectConsignmentShippingOption,subscribeToConsignments:Xe({checkoutService:e,checkoutState:t})}}))(Ze),it=({consignment:e,isLoading:t,resetErrorConsignmentNumber:i,shippingQuoteFailedMessage:s})=>{const{checkoutService:r,checkoutState:l}=(0,p.Q)(),{themeV2:d}=(0,k.w)(),c=et(l,t)(e.id);return a.createElement("div",null,a.createElement("h3",{className:O()("shipping-option-header",{"body-bold":d})},a.createElement(o.A,{id:"shipping.shipping_method_label"})),(!e.availableShippingOptions||!e.availableShippingOptions.length)&&a.createElement(M.A,{type:M.v.Error},s),Boolean(e.availableShippingOptions)&&e.availableShippingOptions&&a.createElement(Pe,{consignmentId:e.id,isLoading:c,onSelectedOption:(e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){yield r.selectConsignmentShippingOption(e,t),i()})),selectedShippingOptionId:e.selectedShippingOption&&e.selectedShippingOption.id,shippingOptions:e.availableShippingOptions}))},nt=({consignment:e,consignmentNumber:t,defaultCountryCode:i,isLoading:s,shippingQuoteFailedMessage:r,onUnhandledError:l,resetErrorConsignmentNumber:d})=>{const{checkoutService:{deleteConsignment:c}}=(0,p.Q)(),{themeV2:m}=(0,k.w)();return a.createElement("div",{className:"consignment-container"},a.createElement("div",{className:O()("consignment-header",{"sub-header":m})},a.createElement("h3",null,a.createElement(o.A,{data:{consignmentNumber:t},id:"shipping.multishipping_consignment_index_heading"})),a.createElement("a",{className:"delete-consignment","data-test":"delete-consignment-button",href:"#",onClick:(0,P.A)((()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){yield c(e.id),d()}))))},a.createElement(R.A,{size:z.l.Small}))),a.createElement(oe,{consignment:e,defaultCountryCode:i,isLoading:s,onUnhandledError:l,selectedAddress:e.shippingAddress}),a.createElement(Me,{consignment:e,consignmentNumber:t,isLoading:s,onUnhandledError:l}),a.createElement(it,{consignment:e,isLoading:s,resetErrorConsignmentNumber:d,shippingQuoteFailedMessage:r}))};var st=i(4209);function at(e){return!!e.length&&(0,s.every)(e,(e=>{var t;return"custom"===(null===(t=e.selectedShippingOption)||void 0===t?void 0:t.type)||e.availableShippingOptions&&e.availableShippingOptions.find((({id:t})=>{var i;return t===(null===(i=e.selectedShippingOption)||void 0===i?void 0:i.id)}))}))}var ot=i(69070),rt=i(11889);const lt=({shouldShowOrderComments:e,shouldDisableSubmit:t,isLoading:i,cartHasChanged:n})=>{const{themeV2:s}=(0,k.w)();return a.createElement(x.A,null,n&&a.createElement(rt.A,{type:rt.v.Error},a.createElement("strong",null,a.createElement(o.A,{id:"shipping.cart_change_error"}))),e&&a.createElement(ot.A,null),a.createElement("div",{className:"form-actions"},a.createElement(B.Ay,{className:s?"body-bold":"",disabled:t,id:"checkout-shipping-continue",isLoading:i,type:"submit",variant:B.Ak.Primary},a.createElement(o.A,{id:"common.continue_action"}))))},dt=({consignmentNumber:e,defaultCountryCode:t,isLoading:i,onUnhandledError:r,resetErrorConsignmentNumber:l,setIsAddShippingDestination:d})=>{const[c,m]=(0,a.useState)(),[u,g]=(0,a.useState)(!1),{unassignedItems:S}=we(),{themeV2:A}=(0,k.w)(),{checkoutState:{data:{getShippingCountries:E,getConsignments:v}},checkoutService:{assignItemsToAddress:C,selectConsignmentShippingOption:y}}=(0,p.Q)(),f=(0,a.useMemo)((()=>{if(!(null==c?void 0:c.address))return;const e=E()||h.M,t=(0,s.find)(e,{code:c.address.countryCode});return Object.assign(Object.assign({},c.address),{country:t?t.name:c.address.countryCode})}),[c]),b=()=>{g(!u)};return a.createElement("div",{className:"consignment-container"},a.createElement("div",{className:O()("consignment-header",{"sub-header":A})},a.createElement("h3",null,a.createElement(o.A,{data:{consignmentNumber:e},id:"shipping.multishipping_consignment_index_heading"}))),a.createElement(oe,{defaultCountryCode:t,isLoading:i,onUnhandledError:r,selectedAddress:f,setConsignmentRequest:m}),f&&a.createElement(a.Fragment,null,a.createElement(fe,{address:f,consignmentNumber:e,isLoading:i,isOpen:u,onAllocateItems:e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var t;let i;if(f)try{const{data:{getConsignments:t}}=yield C({address:f,lineItems:e});i=t()}catch(e){e instanceof te&&r(e)}finally{b(),d(!1),l(),i&&i.length>0&&(yield ae(null!==(t=v())&&void 0!==t?t:[],i,y))}})),onRequestClose:b,unassignedItems:S}),a.createElement("div",{className:"new-consignment-line-item-header"},a.createElement("h3",{className:A?"body-bold":""},a.createElement(o.A,{id:"shipping.multishipping_no_item_allocated_message"})),a.createElement("a",{className:A?"body-cta":"","data-test":"allocate-items-button",href:"#",onClick:(0,P.A)(b)},a.createElement(o.A,{id:"shipping.multishipping_allocate_items"})))))},ct=(0,w.A)(F({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({customerMessage:e})=>({orderComment:e}),enableReinitialize:!0})((({defaultCountryCode:e,isLoading:t,onUnhandledError:i,cartHasChanged:n})=>{const[s,r]=(0,a.useState)(),{themeV2:l}=(0,k.w)(),{checkoutState:{data:{getConsignments:d,getConfig:c}}}=(0,p.Q)(),{unassignedItems:{lineItems:m,shippableItemsCount:u},consignmentList:g}=we(),S=d()||h.M,A=c(),[E,v]=(0,a.useState)(0===S.length),C=(0,st.A)(S),y=(0,a.useMemo)((()=>t||!!m.length||!C||!at(S)),[t,S]);if(!A)return null;const{checkoutSettings:{enableOrderComments:f,shippingQuoteFailedMessage:b}}=A,_=u>0,I=()=>{r(void 0)};return a.createElement(a.Fragment,null,(e=>e>0?a.createElement(M.A,{additionalClassName:l?"body-regular":"",type:M.v.Info},a.createElement(o.A,{data:{count:e},id:"shipping.multishipping_item_to_allocate_message"})):a.createElement(M.A,{additionalClassName:l?"body-regular":"",type:M.v.Success},a.createElement(o.A,{id:"shipping.multishipping_all_items_allocated_message"})))(u),g.map((n=>a.createElement(nt,{consignment:n,consignmentNumber:n.consignmentNumber,defaultCountryCode:e,isLoading:t,key:n.id,onUnhandledError:i,resetErrorConsignmentNumber:I,shippingQuoteFailedMessage:b}))),E&&a.createElement(dt,{consignmentNumber:0===S.length?1:S.length+1,defaultCountryCode:e,isLoading:t,onUnhandledError:i,resetErrorConsignmentNumber:I,setIsAddShippingDestination:v}),_&&a.createElement(B.Ay,{className:O()({"body-regular":l},"add-consignment-button"),onClick:()=>{if(E||C)E?r(S.length+1):(r(void 0),v(!0));else{const e=S.findIndex((e=>!e.selectedShippingOption));if(-1===e)return void v(!0);r(e+1)}},variant:B.Ak.Secondary},a.createElement(o.A,{id:"shipping.multishipping_add_new_destination"})),Boolean(s)&&a.createElement("div",{className:"form-field--error"},a.createElement("span",{className:"form-inlineMessage"},a.createElement(o.A,{data:{consignmentNumber:s},id:"shipping.multishipping_incomplete_consignment_error"}))),a.createElement(lt,{cartHasChanged:n,isLoading:t,shouldDisableSubmit:y,shouldShowOrderComments:f}))})));var mt=i(9343),pt=i(10685),ut=i(60833),gt=i(37958);const ht=(0,a.memo)((({onChange:e})=>{const{themeV2:t}=(0,k.w)(),i=(0,a.useMemo)((()=>a.createElement(o.A,{id:"billing.use_shipping_address_label"})),[]);return a.createElement(gt.A,{id:"sameAsBilling",labelContent:i,name:"billingSameAsShipping",onChange:e,testId:"billingSameAsShipping",themeV2:t})}));var St=i(82922),At=i(44218),Et=i(41410);const vt=({address:e,buttonId:t,formFields:i,isLoading:r,methodId:l,deinitialize:d,initialize:c,onFieldChange:m,onUnhandledError:p=s.noop})=>{const u=i.filter((({custom:e})=>e)),g=u.length>0;return(0,a.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield c({methodId:l})}catch(e){p(e)}})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield d({methodId:l})}catch(e){p(e)}}))})),[]),a.createElement(V.A,{isLoading:r},a.createElement("div",{className:"stepHeader",style:{padding:0}},a.createElement("div",{className:"stepHeader-body subheader"},a.createElement(xe.A,{address:e})),a.createElement("div",{className:"stepHeader-actions subheader"},a.createElement(B.Ay,{id:t,onClick:(0,P.A)(),size:B.Mp.Tiny,testId:"step-edit-button",variant:B.Ak.Secondary},a.createElement(o.A,{id:"common.edit_action"})))),g&&a.createElement(ut.A,{id:"customFieldset"},u.map((e=>{return a.createElement(Et.A,{field:e,key:`${e.id}-${e.name}`,onChange:(t=e.name,e=>{m(t,e)}),parentFieldName:"shippingAddress.customFields"});var t}))))},Ct=e=>{const{methodId:t,formFields:i,onFieldChange:n,initialize:s,deinitialize:o,shippingAddress:r,isShippingStepPending:l}=e,d=(0,a.useCallback)((0,At.B4)((e=>t=>s(Object.assign(Object.assign({},e),t)))),[]),c="edit-ship-button",m={amazonpay:{editAddressButtonId:c}};return a.createElement(vt,{address:r,buttonId:c,deinitialize:o,formFields:i,initialize:d(m),isLoading:l,methodId:t,onFieldChange:n})};var yt=i(62174),ft=i(87647),bt=i(83030),_t=i(38989),It=i(67313),Nt=i(24750),Ot=i(35172);const kt=(0,a.memo)((e=>{const{address:t,formFields:i,isLoading:s,onAddressSelect:r,onFieldChange:l,countries:d,paypalFastlaneShippingComponentRef:c}=e,m=(0,It.A)(t,d),p=i.filter((({custom:e})=>e)),u=p.length>0;return a.createElement(V.A,{hideContentWhenLoading:!0,isLoading:s},a.createElement("div",{className:"stepHeader",style:{padding:0}},a.createElement("div",{className:"stepHeader-body subheader"},a.createElement("div",{className:"vcard checkout-address--static"},!(!m.firstName&&!m.lastName)&&a.createElement("p",{className:"fn address-entry"},a.createElement("span",{className:"first-name"},`${m.firstName} `),a.createElement("span",{className:"family-name"},m.lastName)),!(!m.phone&&!m.company)&&a.createElement("p",{className:"address-entry"},a.createElement("span",{className:"company-name"},`${m.company} `),a.createElement("span",{className:"tel"},m.phone)),a.createElement("div",{className:"adr"},a.createElement("p",{className:"street-address address-entry"},a.createElement("span",{className:"address-line-1"},`${m.address1} `),!!m.address2&&a.createElement("span",{className:"address-line-2"},` / ${m.address2}`)),a.createElement("p",{className:"address-entry"},!!m.city&&a.createElement("span",{className:"locality"},`${m.city}, `),!!m.localizedProvince&&a.createElement("span",{className:"region"},`${m.localizedProvince}, `),!!m.postalCode&&a.createElement("span",{className:"postal-code"},`${m.postalCode} / `),!!m.localizedCountry&&a.createElement("span",{className:"country-name"},`${m.localizedCountry} `)))),a.createElement(Ot.A,null)),a.createElement("div",{className:"stepHeader-actions subheader"},a.createElement(ce.Ay,{onClick:()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if("function"==typeof c.current.showAddressSelector){const e=yield c.current.showAddressSelector();if(e){const t=u?m.customFields:{};r(Object.assign(Object.assign({},e),t))}}})),size:ce.Mp.Tiny,testId:"step-edit-button",variant:ce.Ak.Secondary},a.createElement(o.A,{id:"common.edit_action"})))),u&&a.createElement(Nt.A,{id:"customFieldset"},p.map((e=>{return a.createElement(Et.A,{field:e,key:`${e.id}-${e.name}`,onChange:(t=e.name,e=>l(t,e)),parentFieldName:"shippingAddress.customFields"});var t}))))}));var wt=i(87650),Mt=i(83742);const Lt="shippingAddress",Ft=(0,Mt.A)((({address:e,onAddressSelect:t,onUseNewAddress:i,formFields:n,isLoading:s,formik:{values:{shippingAddress:o},setFieldValue:r},onFieldChange:l})=>{const{checkoutState:{data:{getCustomer:d}}}=(0,p.Q)(),c=d(),m=(null==c?void 0:c.addresses)||[],u=!(null==c?void 0:c.isGuest),g=m&&m.length>0,h=(0,wt.A)(e,m,n);return a.createElement(ut.A,{id:"checkoutShippingAddress"},g&&a.createElement(ut.A,{id:"shippingAddresses"},a.createElement(V.A,{isLoading:s},a.createElement(W.A,{addresses:m,onSelectAddress:t,onUseNewAddress:i,selectedAddress:h?e:void 0,type:q.A.Shipping}))),!h&&a.createElement(V.A,{isLoading:s,unmountContentWhenLoading:!0},a.createElement(H.A,{countryCode:o&&o.countryCode,fieldName:Lt,formFields:n,onAutocompleteToggle:({isOpen:e,inputValue:t})=>{e||l("address1",t)},onChange:(e,t)=>{l(e,t)},setFieldValue:(e,t)=>{const i=n.filter((e=>e.custom)).map((e=>e.name)).includes(e)?`customFields.${e}`:e;r(`${Lt}.${i}`,t)},shouldShowSaveAddress:u,type:q.A.Shipping})))})),Bt=e=>{const{methodId:t,formFields:i,countries:s,onAddressSelect:o,onFieldChange:r,onUnhandledError:l,initialize:d,deinitialize:c,shippingAddress:m,handleFieldChange:p,isLoading:u}=e,[g,h]=(0,a.useState)(!0),S=(0,a.useRef)({}),A=e=>({[e]:{onPayPalFastlaneAddressChange:e=>{S.current.showAddressSelector=e}}});(0,a.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield d(Object.assign(Object.assign(Object.assign({methodId:t},(0,yt.A)(t)?A("bigcommerce_payments_fastlane"):{}),(0,ft.A)(t)?A("braintreefastlane"):{}),(0,bt.A)(t)?A("paypalcommercefastlane"):{}))}catch(e){"function"==typeof l&&e instanceof Error&&l(e)}h(!1)})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield c({methodId:t})}catch(e){"function"==typeof l&&e instanceof Error&&l(e)}}))})),[]);const{shouldShowPayPalFastlaneShippingForm:E}=(0,_t.A)();return a.createElement(V.A,{hideContentWhenLoading:!0,isLoading:g||u},t&&(0,St.A)(t)&&m&&E?a.createElement(kt,{address:m,countries:s,deinitialize:c,formFields:i,initialize:d,isLoading:g,methodId:t,onAddressSelect:o,onFieldChange:r,onUnhandledError:l,paypalFastlaneShippingComponentRef:S}):a.createElement(Ft,{address:m,consignments:e.consignments,formFields:i,isLoading:g,onAddressSelect:o,onFieldChange:p,onUseNewAddress:e.onUseNewAddress}))},Pt=(0,a.memo)((e=>{const{methodId:t,formFields:i,consignments:n,onAddressSelect:s,onFieldChange:o,onUseNewAddress:r,isLoading:l,shippingAddress:d,hasRequestedShippingOptions:c}=e,{setSubmitted:m}=(0,a.useContext)(mt.Ay),p=(e,t)=>{c&&m(!0),o(e,t)};return t&&(0,St.A)(t)&&d?a.createElement(Bt,Object.assign({},e,{handleFieldChange:p,methodId:t,shippingAddress:d})):"amazonpay"===t&&d?a.createElement(Ct,Object.assign({},e,{shippingAddress:d})):a.createElement(Ft,{address:d,consignments:n,formFields:i,isLoading:l,onAddressSelect:s,onFieldChange:p,onUseNewAddress:r})})),Rt=["address1","postalCode","countryCode","city","stateOrProvince","stateOrProvinceCode"];var zt=i(43586);const Tt=({cartHasChanged:e,isMultiShippingMode:t,shouldShowOrderComments:i,shouldShowShippingOptions:n=!0,shouldDisableSubmit:s,isInitialValueLoaded:r,isLoading:l,shippingFormRenderTimestamp:d})=>{const{themeV2:c}=(0,k.w)();return a.createElement(a.Fragment,null,a.createElement($e.Y,{region:"shipping.shippingAddressForm.after"}),a.createElement(ut.A,{id:"checkout-shipping-options",legend:a.createElement(a.Fragment,null,a.createElement(zt.A,{themeV2:c},a.createElement(o.A,{id:"shipping.shipping_method_label"})),e&&a.createElement(rt.A,{type:rt.v.Error},a.createElement("strong",null,a.createElement(o.A,{id:"shipping.cart_change_error"}))))},a.createElement(tt,{isInitialValueLoaded:r,isMultiShippingMode:t,isUpdatingAddress:l,shippingFormRenderTimestamp:d,shouldShowShippingOptions:n})),i&&a.createElement(ot.A,null),a.createElement("div",{className:"form-actions"},a.createElement(B.Ay,{className:c?"body-bold":"",disabled:s,id:"checkout-shipping-continue",isLoading:l,type:"submit",variant:B.Ak.Primary},a.createElement(o.A,{id:"common.continue_action"}))))};class Ut extends a.PureComponent{constructor(e){var t;super(e),this.state={isResettingAddress:!1,isUpdatingShippingData:!1,hasRequestedShippingOptions:!1},this.shouldDisableSubmit=()=>{const{isLoading:e,consignments:t,isValid:i}=this.props,{isUpdatingShippingData:n}=this.state;return!!i&&(e||n||!(0,st.A)(t)||!at(t))},this.handleFieldChange=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const{setFieldValue:t}=this.props;"countryCode"===e&&(t("shippingAddress.stateOrProvince",""),t("shippingAddress.stateOrProvinceCode","")),yield new Promise((e=>setTimeout(e)));const i=Rt.includes(e),{hasRequestedShippingOptions:n}=this.state,{isValid:s}=this.props;s&&this.updateAddressWithFormData(i||!n)})),this.handleAddressSelect=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const{updateAddress:t,onUnhandledError:i=s.noop,values:n,setValues:a}=this.props;this.setState({isResettingAddress:!0});try{yield t(e),a(Object.assign(Object.assign({},n),{shippingAddress:(0,G.A)(this.getFields(e.countryCode),e)}))}catch(e){i(e)}finally{this.setState({isResettingAddress:!1})}})),this.onUseNewAddress=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const{deleteConsignments:e,onUnhandledError:t=s.noop,setValues:i,values:n}=this.props;this.setState({isResettingAddress:!0});try{const t=yield e();i(Object.assign(Object.assign({},n),{shippingAddress:(0,G.A)(this.getFields(t&&t.countryCode),t)}))}catch(e){t(e)}finally{this.setState({isResettingAddress:!1})}}));const{updateAddress:i}=this.props;this.debouncedUpdateAddress=(0,s.debounce)(((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){try{yield i(e,{params:{include:{"consignments.availableShippingOptions":t}}}),t&&this.setState({hasRequestedShippingOptions:!0})}finally{this.setState({isUpdatingShippingData:!1})}}))),null!==(t=e.shippingAutosaveDelay)&&void 0!==t?t:1700)}componentDidUpdate({shippingFormRenderTimestamp:e}){var t,i;const{shippingFormRenderTimestamp:n,setValues:s,getFields:a,shippingAddress:o,isBillingSameAsShipping:r,customerMessage:l,values:d,setFieldValue:c}=this.props;a(d&&(null===(t=d.shippingAddress)||void 0===t?void 0:t.countryCode)).find((({name:e})=>"stateOrProvinceCode"===e))&&(null==o?void 0:o.stateOrProvinceCode)&&!(null===(i=d.shippingAddress)||void 0===i?void 0:i.stateOrProvinceCode)&&c("shippingAddress.stateOrProvinceCode",o.stateOrProvinceCode),n!==e&&s({billingSameAsShipping:r,orderComment:l,shippingAddress:(0,G.A)(a(o&&o.countryCode),o)})}render(){const{cartHasChanged:e,isInitialValueLoaded:t,isLoading:i,onUnhandledError:n,methodId:s,shippingAddress:o,consignments:r,shouldShowOrderComments:l,initialize:d,isValid:c,deinitialize:m,values:{shippingAddress:p},isShippingStepPending:u,shippingFormRenderTimestamp:g}=this.props,{isResettingAddress:h,isUpdatingShippingData:S,hasRequestedShippingOptions:A}=this.state,E=!["amazonpay"].some((e=>e===s));return a.createElement(x.A,{autoComplete:"on"},a.createElement(ut.A,null,a.createElement(Pt,{consignments:r,deinitialize:m,formFields:this.getFields(p&&p.countryCode),hasRequestedShippingOptions:A,initialize:d,isLoading:h,isShippingStepPending:u,methodId:s,onAddressSelect:this.handleAddressSelect,onFieldChange:this.handleFieldChange,onUnhandledError:n,onUseNewAddress:this.onUseNewAddress,shippingAddress:o}),E&&a.createElement("div",{className:"form-body"},a.createElement(ht,null))),a.createElement(Tt,{cartHasChanged:e,isInitialValueLoaded:t,isLoading:i||S,isMultiShippingMode:!1,shippingFormRenderTimestamp:g,shouldDisableSubmit:this.shouldDisableSubmit(),shouldShowOrderComments:l,shouldShowShippingOptions:c}))}updateAddressWithFormData(e){const{shippingAddress:t,values:{shippingAddress:i}}=this.props,n=i&&(0,d.A)(i);Array.isArray(null==t?void 0:t.customFields)&&(e=!(0,s.isEqual)(null==t?void 0:t.customFields,null==n?void 0:n.customFields)||e),n&&!(0,c.A)(n,t)&&(this.setState({isUpdatingShippingData:!0}),this.debouncedUpdateAddress(n,e))}getFields(e){const{getFields:t}=this.props;return t(e)}}Ut.contextType=mt.Ay;const Vt=(0,w.A)(F({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,shippingAddress:t,isBillingSameAsShipping:i,customerMessage:n})=>({billingSameAsShipping:i,orderComment:n,shippingAddress:(0,G.A)(e(t&&t.countryCode),t)}),isInitialValid:({shippingAddress:e,getFields:t,language:i})=>!!e&&(0,$.A)({language:i,formFields:t(e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:i})=>function(e){const t=[v.A.BraintreeAcceleratedCheckout,v.A.PayPalCommerceAcceleratedCheckout];return Boolean(e&&!t.includes(e))}(i)?(0,U.Ik)({shippingAddress:(0,U.RZ)((i=>(0,pt.A)({translate:(0,$.X)(e),formFields:t(i&&i.countryCode)})))}):(0,U.Ik)({shippingAddress:(0,U.RZ)((i=>(0,$.A)({language:e,formFields:t(i&&i.countryCode)})))}),enableReinitialize:!1})(Ut)),xt=({cartHasChanged:e,isBillingSameAsShipping:t,isMultiShippingMode:i,onMultiShippingSubmit:n,onSingleShippingSubmit:s,onUnhandledError:o,isInitialValueLoaded:r,setIsMultishippingMode:l})=>{const{checkoutState:{data:{getConfig:d}}}=(0,p.Q)(),{cart:c,consignments:m,customerMessage:u,deleteConsignments:g,deinitializeShippingMethod:h,getFields:S,isLoading:A,initializeShippingMethod:E,isShippingStepPending:v,methodId:C,shouldShowOrderComments:y,shippingAddress:f,signOut:N,updateShippingAddress:O}=b(),{extensionState:{shippingFormRenderTimestamp:k}}=(0,_.O)(),w=d();(0,a.useEffect)((()=>{var e,t;if(k){const i=null!==(t=null===(e=null==w?void 0:w.checkoutSettings)||void 0===e?void 0:e.hasMultiShippingEnabled)&&void 0!==t&&t,n=!!c&&!!m&&i&&(0,I.A)(m,c.lineItems);l(n)}}),[k]);return i?a.createElement(ct,{cartHasChanged:e,customerMessage:u,defaultCountryCode:null==f?void 0:f.countryCode,isLoading:A,onSubmit:n,onUnhandledError:o}):a.createElement(Vt,{cartHasChanged:e,consignments:m,customerMessage:u,deinitialize:h,deleteConsignments:g,getFields:S,initialize:E,isBillingSameAsShipping:t,isInitialValueLoaded:r,isLoading:A,isMultiShippingMode:i,isShippingStepPending:v,methodId:C,onSubmit:s,onUnhandledError:o,shippingAddress:f,shippingFormRenderTimestamp:k,shouldShowOrderComments:y,signOut:N,updateAddress:O})},jt=(0,a.memo)((({isMultiShippingMode:e,onMultiShippingChange:t,shouldShowMultiShipping:i,cartHasPromotionalItems:n})=>{const[s,r]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!1),{themeV2:m}=(0,k.w)(),p=i&&e,u=i&&!e&&n;return a.createElement(a.Fragment,null,a.createElement($e.Y,{region:"shipping.shippingAddressForm.before"}),a.createElement("div",{className:O()(["form-legend-container","shipping-header"])},a.createElement(zt.A,{testId:"shipping-address-heading",themeV2:m},a.createElement(o.A,{id:e?"shipping.multishipping_address_heading":"shipping.shipping_address_heading"})),p&&a.createElement(a.Fragment,null,a.createElement(l.A,{action:()=>{r(!1),t()},actionButtonLabel:a.createElement(o.A,{id:"common.proceed_action"}),headerId:"shipping.ship_to_single_action",isModalOpen:s,messageId:"shipping.ship_to_single_message",onRequestClose:()=>r(!1)}),a.createElement("a",{className:m?"body-cta":"","data-test":"shipping-mode-toggle",href:"#",onClick:(0,P.A)((()=>r(!0)))},a.createElement(o.A,{id:"shipping.ship_to_single"}))),u&&a.createElement(a.Fragment,null,a.createElement(l.A,{action:()=>c(!1),actionButtonLabel:a.createElement(o.A,{id:"common.back_action"}),headerId:"shipping.multishipping_unavailable_action",isModalOpen:d,messageId:"shipping.multishipping_unavailable_message",onRequestClose:()=>c(!1)}),a.createElement("a",{className:m?"body-cta":"","data-test":"shipping-mode-toggle",href:"#",onClick:(0,P.A)((()=>c(!0)))},a.createElement(o.A,{id:"shipping.ship_to_multi"}))),!p&&!u&&i&&a.createElement("a",{className:m?"body-cta":"","data-test":"shipping-mode-toggle",href:"#",onClick:(0,P.A)(t)},a.createElement(o.A,{id:e?"shipping.ship_to_single":"shipping.ship_to_multi"}))))}));var Dt=i(59713);const Ht=({methodId:e,initialize:t,deinitialize:i,onUnhandledError:o=s.noop})=>((0,a.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t({methodId:e})}catch(e){o(e)}})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield i({methodId:e})}catch(e){o(e)}}))})),[]),a.createElement(a.Fragment,null,a.createElement("div",{className:"stepHeader",style:{padding:0}},a.createElement("div",{id:"StripeUpeShipping",style:{width:"100%"}})),a.createElement("br",null)));function qt(e,t){var i;const n={MX:{"Ags.":"AGU","B.C.":"BCN","B.C.S.":"BCS","Camp.":"CAM","Coah.":"COA","Col.":"COL","Chis.":"CHP","Chih.":"CHH","Dgo.":"DUR","Gto.":"GUA","Gro.":"GRO","Hgo.":"HID","Jal.":"JAL","MÃ©x.":"MEX",CDMX:"MEX","Mich.":"MIC","Mor.":"MOR","Nay.":"NAY","N.L.":"NLE","Oax.":"OAX","Pue.":"PUE","Qro.":"QUE","Q.R.":"ROO","S.L.P.":"SLP","Sin.":"SIN","Son.":"SON","Tab.":"TAB","Tamps.":"TAM","Tlax.":"TLA","Ver.":"VER","Yuc.":"YUC","Zac.":"ZAC"},AR:{"Ciudad AutÃ³noma de Buenos Aires":"C","Buenos Aires":"B",Catamarca:"K",Chaco:"H",Chubut:"U",CÃ³rdoba:"X",Corrientes:"W","Entre RÃ­os":"E",Formosa:"P",Jujuy:"Y","La Pampa":"L","La Rioja":"F",Mendoza:"M",Misiones:"N",NeuquÃ©n:"Q",Salta:"A","San Juan":"J","San Luis":"D","Santa Fe":"S","Santiago del Estero":"G","Tierra del Fuego":"V",TucumÃ¡n:"W"},IN:{"Andhra Pradesh":"AP","Arunachal Pradesh":"AR",Assam:"AS",Bihar:"BR",Chhattisgarh:"CG",Goa:"GA",Gujarat:"GJ",Haryana:"HR","Himachal Pradesh":"HP","Jammu and Kashmir":"JK",Jharkhand:"JH",Karnataka:"KA",Kerala:"KL","Madhya Pradesh":"MP",Maharashtra:"MH",Manipur:"MN",Meghalaya:"ML",Mizoram:"MZ",Nagaland:"NL",Odisha:"OR",Punjab:"PB",Rajasthan:"RJ",Sikkim:"SK","Tamil Nadu":"TN",Tripura:"TR",Uttarakhand:"UK","Uttar Pradesh":"UP","West Bengal":"WB","Andaman and Nicobar Islands":"AN",Chandigarh:"CH","Dadra and Nagar Haveli and Daman and Diu":"DN",Lakshadweep:"LD",Delhi:"DL",Puducherry:"PY",Telangana:"TS"},ID:{Bali:"BA",Banten:"BT",Bengkulu:"BE",Aceh:"DA","DKI Jakarta":"JK","Sumatera Utara":"SU","Sumatera Barat":"SB",Riau:"SI",Jambi:"JA","Sumatera Selatan":"SS",Lampung:"LA","Jawa Barat":"JB","Jawa Timur":"JT","Daerah Istimewa Yogyakarta":"DY","Kalimantan Barat":"KB","Kalimantan Tengah":"KT","Kalimantan Timur":"KI","Kalimantan Selatan":"KS","Nusa Tenggara Barat":"NB","Nusa Tenggara Timur":"NT","Sulawesi Selatan":"SN","Sulawesi Tengah":"ST","Sulawesi Utara":"SA","Sulawesi Tenggara":"SG",Maluku:"MA","Maluku Utara":"MU",Gorontalo:"GO"},MY:{Johor:"JHR",Kedah:"KDH",Kelantan:"KTN",Melaka:"MLK","Negeri Sembilan":"NSN",Pahang:"PHG","Pulau Pinang":"PNG",Perak:"PRK",Perlis:"PLS",Selangor:"SGR",Terengganu:"TRG",Sabah:"SBH",Sarawak:"SRW","Kuala Lumpur":"KUL",Labuan:"LBN",Putrajaya:"PJY"},IE:{Carlow:"CW",Cavan:"CN",Clare:"CE",Donegal:"DL",Dublin:"D",Galway:"G",Kildare:"KE",Kilkenny:"KK",Laois:"LS",Leitrim:"LM",Longford:"LD",Louth:"LH",Mayo:"MO",Meath:"MH",Monaghan:"MN",Offaly:"OY",Roscommon:"RN",Sligo:"SO",Tipperary:"TA",Waterford:"WD",Westmeath:"WH",Wexford:"WX",Wicklow:"WW"},JP:{Aichi:"23",Akita:"05",Aomori:"02",Chiba:"12",Ehime:"38",Fukui:"18",Fukuoka:"40",Fukushima:"07",Gifu:"21",Gunma:"10",Hiroshima:"34",Hokkaido:"01",Hyogo:"28",Ibaraki:"08",Ishikawa:"17",Iwate:"03",Kagawa:"37",Kagoshima:"46",Kanagawa:"14",Kochi:"39",Kumamoto:"43",Kyoto:"26",Mie:"24",Miyagi:"04",Miyazaki:"45",Nagano:"20",Nagasaki:"42",Nara:"29",Niigata:"15",Oita:"44",Okayama:"33",Okinawa:"47",Osaka:"27",Saga:"41",Saitama:"11",Shiga:"25",Shimane:"32",Shizuoka:"22",Tochigi:"09",Tokushima:"36",Tokyo:"13",Tottori:"31",Toyama:"16",Wakayama:"30",Yamagata:"06",Yamaguchi:"35",Yamanashi:"19"}};return n[e]?null!==(i=n[e][t])&&void 0!==i?i:function(e,t){return Object.keys(e).find((i=>e[i]===t))||t}(n[e],t):t}const $t=(0,a.memo)((e=>{const{countries:t,consignments:i,onAddressSelect:s,initialize:o,deinitialize:r,shouldDisableSubmit:l,onSubmit:d,step:c,isStripeLoading:m,isStripeAutoStep:p,isShippingMethodLoading:u,shippingAddress:g}=e,[h,S]=(0,a.useState)(!0),[A,E]=(0,a.useState)(!0),[v,C]=(0,a.useState)({firstName:"",lastName:"",company:"",address1:"",address2:"",city:"",stateOrProvince:"",stateOrProvinceCode:"",shouldSaveAddress:!0,country:"",countryCode:"",postalCode:"",phone:"",customFields:[]}),y=(0,a.useCallback)((()=>{m&&m()}),[m]);(0,a.useEffect)((()=>{if(i[0]){const{availableShippingOptions:e}=i[0];e&&!Ue(e)&&y()}}),[i]),(0,a.useEffect)((()=>{v.firstName&&(0,st.A)(i)&&(!A&&!h&&!u)&&(m&&p)&&(m(),p(),d({billingSameAsShipping:!0,shippingAddress:v,orderComment:""}))}),[A,d,v,l,u,h,i]);const f=null==t?void 0:t.map((e=>({code:e.code,name:e.name}))),b=f?f.map((e=>e.code)).join(", "):"",_=(0,a.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var t;const{complete:i,phoneFieldRequired:n,value:{address:a={country:"",state:"",line1:"",line2:"",city:"",postal_code:""},name:o="",firstName:r="",lastName:l="",phone:d=""}}=e;if(i){((e=!0,t,i)=>{const n=c.isComplete,s=(null==g?void 0:g.firstName)&&e;return n||s||t&&!i})(null==e?void 0:e.isNewAddress,n,d)&&y();const i=null==o?void 0:o.split(" "),m=null===(t=null==f?void 0:f.find((e=>e.code===a.country)))||void 0===t?void 0:t.name,p=qt(a.country,a.state),u={firstName:r||i[0],lastName:l||i[1],company:"",address1:a.line1,address2:a.line2||"",city:a.city,stateOrProvince:p,stateOrProvinceCode:p,shouldSaveAddress:!0,country:m||a.country,countryCode:a.country,postalCode:a.postal_code,phone:d||"",customFields:[]};c.isComplete||E((e=>!e)),s(u),C(u),e.isNewAddress!==h&&S((e=>!e))}else y()}))),[f,s]),I=(0,a.useCallback)((0,At.B4)((e=>t=>o(Object.assign(Object.assign({},e),t)))),[]),N=(e,t)=>{const i=document.getElementById(e);if(i)return(0,Dt.A)(i,t)},O={stripeupe:{container:"StripeUpeShipping",onChangeShipping:_,availableCountries:b,getStyles:(0,a.useCallback)((()=>{const e="stripe-card-component-field",t=N(`${e}--input`,["color","background-color","border-color","box-shadow"]),i=N(`${e}--label`,["color"]),n=N(`${e}--error`,["color"]);return i&&t&&n?{labelText:i.color,fieldText:t.color,fieldPlaceholderText:t.color,fieldErrorText:n.color,fieldBackground:t["background-color"],fieldInnerShadow:t["box-shadow"],fieldBorder:t["border-color"]}:void 0}),[]),getStripeState:qt,gatewayId:"stripeupe",methodId:"card"}};return a.createElement(a.Fragment,null,a.createElement(Ht,{deinitialize:r,initialize:I(O),methodId:"stripeupe"}),(()=>{const e="stripe-card-component-field";return a.createElement("div",{className:"optimizedCheckout-form-input",id:`${e}--input`},a.createElement("div",{className:"form-field--error"},a.createElement("div",{className:"optimizedCheckout-form-label",id:`${e}--error`})),a.createElement("div",{className:"optimizedCheckout-form-label",id:`${e}--label`}))})())})),Gt=(0,w.A)(F({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,shippingAddress:t,isBillingSameAsShipping:i,customerMessage:n})=>({billingSameAsShipping:i,orderComment:n,shippingAddress:(0,G.A)(e(t&&t.countryCode),t)}),isInitialValid:({shippingAddress:e,getFields:t,language:i})=>!!e&&(0,$.A)({language:i,formFields:t(e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:i})=>i?(0,U.Ik)({shippingAddress:(0,U.RZ)((i=>(0,pt.A)({translate:(0,$.X)(e),formFields:t(i&&i.countryCode)})))}):(0,U.Ik)({shippingAddress:(0,U.RZ)((i=>(0,$.A)({language:e,formFields:t(i&&i.countryCode)})))}),enableReinitialize:!1})((e=>{const{checkoutService:t,checkoutState:i}=(0,p.Q)(),{data:{getConsignments:o,getShippingCountries:r}}=i,l=o()||[],d=t.initializeShipping,c=t.deinitializeShipping,m=r()||h.M,[u]=(0,a.useState)(!1),{cartHasChanged:g,isInitialValueLoaded:S,isLoading:A,isStripeLoading:E,shippingAddress:v,shouldShowOrderComments:C,isValid:y,onSubmit:f,isStripeAutoStep:b,step:_,isShippingMethodLoading:I,updateAddress:N,onUnhandledError:O=s.noop,values:k,setValues:w,getFields:M}=e,L=()=>!!y&&(A||u||!(0,st.A)(l)),F=(0,a.useCallback)((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield N(e),w(Object.assign(Object.assign({},k),{shippingAddress:(0,G.A)(M(e.countryCode),e)}))}catch(e){O(e)}}))),[k,w,O]);return a.createElement(x.A,{autoComplete:"on"},a.createElement(ut.A,null,a.createElement($t,{consignments:l,countries:m,deinitialize:c,initialize:d,isShippingMethodLoading:I,isStripeAutoStep:b,isStripeLoading:E,onAddressSelect:F,onSubmit:f,shippingAddress:v,shouldDisableSubmit:L(),step:_}),a.createElement("div",{className:"form-body"},a.createElement(ht,null))),a.createElement(Tt,{cartHasChanged:g,isInitialValueLoaded:S,isLoading:A||u,isMultiShippingMode:!1,shouldDisableSubmit:L(),shouldShowOrderComments:C,shouldShowShippingOptions:y}))}))),Kt=({cartHasChanged:e,isBillingSameAsShipping:t,isInitialValueLoaded:i,isMultiShippingMode:n,step:s,onSubmit:o,onMultiShippingChange:l,onUnhandledError:d,isLoading:c})=>{const{customerMessage:m,getFields:p,isLoading:u,methodId:g,updateShippingAddress:h,shippingAddress:S,shouldShowMultiShipping:A,shouldShowOrderComments:E}=b(),[v,C]=(0,a.useState)(!0),[y,f]=(0,a.useState)(!1);return a.createElement(a.Fragment,null,a.createElement(r.A,{isLoading:y||v}),a.createElement("div",{className:"checkout-form",style:{display:y||v?"none":void 0}},a.createElement(jt,{isMultiShippingMode:n,onMultiShippingChange:l,shouldShowMultiShipping:A}),a.createElement(Gt,{cartHasChanged:e,customerMessage:m,getFields:p,isBillingSameAsShipping:t,isInitialValueLoaded:i,isLoading:c,isMultiShippingMode:n,isShippingMethodLoading:u,isStripeAutoStep:()=>{f(!0)},isStripeLoading:()=>{C(!1)},methodId:g,onSubmit:o,onUnhandledError:d,shippingAddress:S,shouldShowOrderComments:E,step:s,updateAddress:h})))};const Jt=function({cartHasChanged:e,navigateNextStep:t,onCreateAccount:i,onReady:m=s.noop,onSignIn:p,onUnhandledError:u=s.noop,onToggleMultiShipping:g=s.noop,isMultiShippingMode:h,isBillingSameAsShipping:S,setIsMultishippingMode:A,step:E}){const[v,C]=(0,a.useState)(!0),[y,f]=(0,a.useState)(!1),{billingAddress:_,customerMessage:I,cartHasPromotionalItems:N,consignments:O,countries:k,customer:w,deleteConsignments:M,loadShippingAddressFields:L,loadBillingAddressFields:F,loadShippingOptions:B,methodId:P,shippingAddress:R,shouldRenderStripeForm:z,shouldShowMultiShipping:T,updateCheckout:U,updateShippingAddress:V,updateBillingAddress:x}=b();(0,a.useEffect)((()=>{(()=>{(0,n.__awaiter)(this,void 0,void 0,(function*(){try{yield Promise.all([L(),B(),F()]),N&&h&&f(!0),m()}catch(e){e instanceof Error&&u(e)}finally{C(!1)}}))})()}),[]);const j=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){try{C(!0),h&&O.length?yield V(O[0].shippingAddress):yield M()}catch(e){e instanceof Error&&u(e)}finally{C(!1)}g()})),D=(0,a.useCallback)((()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){f(!1),yield j()}))),[]),H=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=e.shippingAddress&&(0,d.A)(e.shippingAddress),n=[],s=function(e){return["amazonpay"].some((t=>t===e))}(P);(0,c.A)(i,R)&&(null==R?void 0:R.shouldSaveAddress)===(null==i?void 0:i.shouldSaveAddress)||n.push(V(i||{})),e.billingSameAsShipping&&i&&!(0,c.A)(i,_)&&!s&&n.push(x(i)),I!==e.orderComment&&n.push(U({customerMessage:e.orderComment}));try{yield Promise.all(n),t(e.billingSameAsShipping)}catch(e){e instanceof Error&&u(e)}}));return z&&!w.email&&k.length>0?a.createElement(Kt,{cartHasChanged:e,isBillingSameAsShipping:S,isInitialValueLoaded:!v,isInitializing:v,isLoading:v,isMultiShippingMode:h,onMultiShippingChange:j,onSubmit:H,onUnhandledError:u,step:E}):a.createElement(r.A,{isLoading:v,renderWhileLoading:!0},a.createElement("div",{className:"checkout-form"},a.createElement(l.A,{action:D,actionButtonLabel:a.createElement(o.A,{id:"common.ok_action"}),headerId:"shipping.multishipping_unavailable_action",isModalOpen:y,messageId:"shipping.checkout_switched_to_single_shipping",shouldShowCloseButton:!1}),a.createElement(jt,{cartHasPromotionalItems:N,isMultiShippingMode:h,onMultiShippingChange:j,shouldShowMultiShipping:T}),a.createElement(xt,{cartHasChanged:e,isBillingSameAsShipping:S,isInitialValueLoaded:!v,isMultiShippingMode:h,onCreateAccount:i,onMultiShippingSubmit:e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){try{I!==e.orderComment&&(yield U({customerMessage:e.orderComment})),t(!1)}catch(e){e instanceof Error&&u(e)}})),onSignIn:p,onSingleShippingSubmit:H,onUnhandledError:u,setIsMultishippingMode:A})))}},38116:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(70355);const s=(0,i(45080).A)((()=>n.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}))))},52523:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(70355);const s=({children:e,testId:t})=>n.createElement("span",{className:"tooltip tooltip--basic","data-test":t},e)},59713:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(69440);function s(e,t,i){const s=window.getComputedStyle(e,i);return t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:s.getPropertyValue((0,n.kebabCase)(t))})),{})}},60288:(e,t,i)=>{i.d(t,{v:()=>c,A:()=>m});var n=i(3375),s=i.n(n),a=i(70355),o=i(2156);const r=(0,o.A)((()=>a.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},a.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})))),l=(0,o.A)((()=>a.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},a.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})))),d=(0,o.A)((()=>a.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},a.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}))));var c;!function(e){e.Error="error",e.Info="info",e.Success="success",e.Warning="warning"}(c||(c={}));const m=({additionalClassName:e,children:t,icon:i,testId:n,type:o})=>{const m=(0,a.useId)();return a.createElement("div",{"aria-describedby":m,className:s()("alertBox",e,{"alertBox--info":o===c.Info||!o},{"alertBox--error":o===c.Error},{"alertBox--success":o===c.Success},{"alertBox--warning":o===c.Warning}),"data-test":n},a.createElement("div",{className:"alertBox-column alertBox-icon"},i||function(e){switch(e){case c.Error:case c.Warning:return a.createElement(r,null);case c.Success:return a.createElement(l,null);case c.Info:default:return a.createElement(d,null)}}(o)),a.createElement("div",{"aria-live":o===c.Error?"assertive":"polite",className:"alertBox-column alertBox-message",id:m,role:o===c.Error?"alert":"status"},t))}},63163:(e,t,i)=>{i.d(t,{Ak:()=>n,Ay:()=>c,Mp:()=>s});var n,s,a=i(31635),o=i(3375),r=i.n(o),l=i(70355);function d(e){const{className:t,isFullWidth:i,isLoading:a,size:o,variant:l}=e;return r()("button",t,{"button--primary":l===n.Primary},{"button--tertiary":l===n.Secondary},{"button--action":l===n.Action},{"button--small":o===s.Small},{"button--tiny":o===s.Tiny},{"button--large":o===s.Large},{"button--slab":i},{"optimizedCheckout-buttonPrimary":l===n.Primary||l===n.Action},{"optimizedCheckout-buttonSecondary":l===n.Secondary},{"is-loading":a})}!function(e){e.Primary="primary",e.Secondary="secondary",e.Action="action"}(n||(n={})),function(e){e.Small="small",e.Tiny="tiny",e.Large="large"}(s||(s={}));const c=e=>{var{children:t,className:i,disabled:n,isFullWidth:s,isLoading:o,size:r,testId:c,type:m,variant:p}=e,u=(0,a.__rest)(e,["children","className","disabled","isFullWidth","isLoading","size","testId","type","variant"]);return l.createElement("button",Object.assign({},u,{className:d({className:i,isFullWidth:s,isLoading:o,size:r,variant:p}),"data-test":c,disabled:n||o,type:m||"button"}),t)}},76966:(e,t,i)=>{i.d(t,{A:()=>o});var n=i(3375),s=i.n(n),a=i(70355);const o=({children:e,additionalClassName:t})=>a.createElement("h2",{className:s()("modal-header-title optimizedCheckout-headingSecondary",t),"data-test":"modal-heading"},e)},82259:(e,t,i)=>{i.d(t,{C:()=>c,A:()=>m});var n=i(31635),s=i(69440),a=i(70355),o=i(44218),r=i(32312);const l=({children:e,className:t="accordion",defaultSelectedItemId:i,isDisabled:n,onSelect:l=s.noop})=>{const[d,c]=(0,a.useState)(i),m=e=>{n||(c(e),l(e))},p=(0,o.B4)((e=>({onToggle:m,selectedItemId:e})));return a.createElement(r.A.Provider,{value:p(d)},a.createElement("ul",{className:t},e))};var d=i(83742);const c=(0,a.createContext)(void 0),m=(0,d.A)((0,a.memo)((e=>{var{formik:{setFieldValue:t},name:i,onSelect:o=s.noop}=e,r=(0,n.__rest)(e,["formik","name","onSelect"]);(0,a.useEffect)((()=>()=>{t(i,"")}),[]);const d=(0,a.useCallback)((e=>{t(i,e),o(e)}),[i,o,t]),m=(0,a.useMemo)((()=>({name:i})),[i]);return a.createElement(c.Provider,{value:m},a.createElement(l,Object.assign({},r,{className:"form-checklist optimizedCheckout-form-checklist",onSelect:d})))})))},83651:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(70355);const s=(0,i(45080).A)((()=>n.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}))))},83742:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(31635),s=i(69462),a=i(70355),o=i(30540),r=i.n(o);function l(e){const t=(0,a.memo)((t=>a.createElement(e,Object.assign({},t))),((e,t)=>{var{formik:i}=e,s=(0,n.__rest)(e,["formik"]),a=t.formik,o=(0,n.__rest)(t,["formik"]);return r()(i,a)&&r()(s,o)})),i=(0,s.Ng)(t);return i.displayName=`ConnectFormik(${e.displayName||e.name})`,i}},97429:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(70355),s=i(75514),a=i(77175),o=i(32657);const r=({children:e,placement:t="bottom",tooltip:i})=>{const[r,l]=(0,n.useState)(!1),d=()=>{l(!0)},c=()=>{l(!1)};return n.createElement(a.mS,null,n.createElement(o.O,null,(({ref:t})=>n.createElement("span",{onBlur:c,onFocus:d,onMouseEnter:d,onMouseLeave:c,ref:t},e))),n.createElement(s.N,{modifiers:[{name:"hide",enabled:!1},{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!1}],placement:t},(({ref:e,style:t})=>r&&n.createElement("div",{ref:e,style:t},i))))}}}]);
//# sourceMappingURL=shipping-9e8cfa7a.js.map